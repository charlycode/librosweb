<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <title>8.2. Teclado virtual (Introducción a AJAX)</title>
        <link href="../../css/main-fa23fb7.css" rel="stylesheet" type="text/css" />
        <script type="text/javascript">
            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-82842-2']);
            _gaq.push(['_trackPageview']);

            (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
            })();
        </script>
        <link rel="apple-touch-icon" type="image/png" href="../../apple-touch-icon.png" />
        <link rel="apple-touch-icon-precomposed" type="image/png" href="../../apple-touch-icon.png" />
        <meta name="apple-mobile-web-app-title" content="LibrosWeb" />

        <link rel="shortcut icon" type="image/png" href="../../favicon.png" />
        <meta name="site:version" content="fa23fb7" />
        <link rel="author" href="https://plus.google.com/u/0/107307901774377088868" />
        <link rel="prev" href="../capitulo_8.html" />
        <link rel="next" href="autocompletar.html" />
        <link rel="start" href="../index.html" />
        <meta name="twitter:site" content="@librosweb" />
        <link rel="search" type="application/opensearchdescription+xml" href="http://librosweb.es/opensearch/documentation.xml" title="Libros y tutoriales de LibrosWeb.es" />
        <meta property="fb:page_id" content="437758756273955" />
        <meta property="fb:app_id" content="437758756273955" />
        <meta property="og:type" content="website" />
        <meta property="og:title" content="8.2. Teclado virtual (Introducción a AJAX)" />
        <meta property="og:image" content="http://www.gravatar.com/avatar/9f219b4dfaa677bfd0f47753c02d5126.png?s=200" />
        <meta name="msapplication-TileColor" content="#CC1414" />
        <meta name="application-name" content="LibrosWeb" />
        <meta name="msapplication-tooltip" content="Libros y tutoriales sobre HTML, CSS, JavaScript, PHP y otras tecnologías web." />
    </head>
    <body class="book_page ajax">
    <div id="container" class="container">
        <div id="header">
            <h1><a href="../../index.html" title="LibrosWeb.es">LibrosWeb</a></h1>
            <form action="/buscar"><input type="text" placeholder="buscar..." name="q"/></form>
        </div>
        <div id="content"><div class="row">
        <ul class="breadcrumbs span12">
  <li><a href="../../index.html">Inicio</a></li>
  <li><a href="../index.html">Introducción a AJAX</a></li>
  <li><a href="../capitulo_8.html">Capítulo 8. Técnicas básicas con AJAX</a></li>
  <li class="current"><span>8.2. Teclado virtual</span></li>
</ul>

<div class="span9">
    <h1 id="teclado_virtual"><span>8.2.</span> Teclado virtual</h1>
    

<h3 id="contexto">8.3.1. Contexto</h3>

<p>Algunas aplicaciones web multi-idioma disponen de la posibilidad de introducir información en muchos idiomas diferentes. El principal problema de estas aplicaciones es que el teclado físico que utiliza el usuario no siempre corresponde al idioma en el que se quieren introducir los contenidos.</p>

<p>La solución habitual de este problema consiste en mostrar un teclado virtual en la pantalla que muestre el valor correcto para cada tecla del idioma seleccionado por el usuario.</p>

<h3 id="solucion_propuesta">8.3.2. Solución propuesta</h3>

<p>A continuación se muestra el aspecto gráfico del teclado virtual que se va a construir mediante AJAX:</p>

<div class="figure" id="figure_8_2">
    <img src="../../img/ajax/f0802.gif" alt="Aspecto final del teclado virtual construido con AJAX" />

    <p class="caption"><strong>Figura 8.2</strong> Aspecto final del teclado virtual construido con AJAX</p>
</div>


<p><div class="exercise"><p class="title">Ejercicio 18</p> <p>Se propone la construcción de un teclado virtual que permita escribir los contenidos en diversos idiomas y alfabetos. El script hace un uso intensivo de elementos de AJAX como los eventos, DOM, javascript avanzado, JSON y el objeto <code>XMLHttpRequest</code>.</p>

<p>Cada uno de los teclados correspondientes a un idioma se carga desde el servidor, para no sobrecargar la aplicación. El teclado de un idioma concreto está formado por varios teclados alternativos o variantes. Así, se encuentra el teclado <code>normal</code> para las teclas que se muestran inicialmente, el teclado <code>caps</code> con las teclas que se escriben al pulsar sobre la tecla <code>Bloq. Mayúsculas</code>, el teclado <code>shift</code> que contiene los símbolos que se escriben al pulsar sobre la tecla <code>Shift</code> y el teclado <code>altgr</code> que contiene los símbolos que se pueden escribir después de pulsar la tecla <code>Alt Gr</code>.</p>

<p>Por tanto, cada idioma tiene cuatro teclados diferentes: <code>normal</code>, <code>caps</code>, <code>shift</code> y <code>altgr</code>. Inicialmente, el script proporciona el objeto <code>teclados</code> con un elemento llamado <code>es</code> que contiene los cuatro teclados correspondientes al idioma español.</p>

<div class="figure" id="figure_8_3">
    <img src="../../img/ajax/f0803.gif" alt="Detalle del teclado para el idioma español y la variante &quot;normal&quot;" />

    <p class="caption"><strong>Figura 8.3</strong> Detalle del teclado para el idioma español y la variante &quot;normal&quot;</p>
</div>


<div class="figure" id="figure_8_4">
    <img src="../../img/ajax/f0804.gif" alt="Detalle del teclado para el idioma español y la variante &quot;caps&quot;" />

    <p class="caption"><strong>Figura 8.4</strong> Detalle del teclado para el idioma español y la variante &quot;caps&quot;</p>
</div>


<div class="figure" id="figure_8_5">
    <img src="../../img/ajax/f0805.gif" alt="Detalle del teclado para el idioma español y la variante &quot;shift&quot;" />

    <p class="caption"><strong>Figura 8.5</strong> Detalle del teclado para el idioma español y la variante &quot;shift&quot;</p>
</div>


<div class="figure" id="figure_8_6">
    <img src="../../img/ajax/f0806.gif" alt="Detalle del teclado para el idioma español y la variante &quot;altgr&quot;" />

    <p class="caption"><strong>Figura 8.6</strong> Detalle del teclado para el idioma español y la variante &quot;altgr&quot;</p>
</div>


<p>1) Crear una función llamada <code>cargaTeclado()</code> que muestre en cada tecla virtual el valor de la tecla correspondiente al teclado de un idioma y una variante determinados.</p>

<p>2) Al cargar la página, se debe ejecutar la función <code>cargaTeclado()</code>. Previamente, se debe establecer el valor inicial de dos variables globales llamadas <code>tecladoIdioma</code> y <code>tecladoVariante</code>.</p>

<p>En la misma función <code>cargaTeclado()</code>, se debe asignar un evento a cada tecla activa para que al pulsar con el ratón sobre ella, se ejecute la función <code>pulsaTecla()</code>.</p>

<p>3) En la función <code>pulsaTecla()</code> se obtiene el carácter de la tecla que se ha pulsado correspondiente al teclado activo en ese momento. La tecla se añade a un array global llamado <code>teclasPulsadas</code>.</p>

<p>Por último, desde la función <code>pulsaTecla()</code> se llama a una función <code>mostrarContenidos()</code> que actualiza el texto mostrado en el área reservada para mostrar las teclas pulsadas.</p>

<p>4) Añadir la lógica para tratar las <em>"teclas especiales"</em>. Para ello, añadir un evento adecuado que llame a la función <code>pulsaTeclaEspecial()</code> cuando el usuario pulse sobre <code>Enter</code>, <code>Tabulador</code>, <code>Barra Espaciadora</code> y <code>Borrado</code> (<code>BackSpace</code>). En cada caso, se debe añadir al array de teclas pulsadas el carácter correspondiente: <code>\n</code>, <code>\t</code>, espacio en blanco y el borrado de la última tecla pulsada.</p>

<p>5) Modificar la función <code>mostrarContenidos()</code> para que antes de mostrar las teclas que se han pulsado, convierta los caracteres especiales en caracteres correctos para mostrarlos en un elemento HTML: las nuevas líneas (<code>\n</code>) se transforman en <code>&lt;br/&gt;</code>, los espacios en blanco se transforman en <code>&amp;nbsp;</code> y el tabulador (<code>\t</code>) se transforma en <code>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;</code>.</p>

<p>6) Cuando se pulsa la tecla <code>Bloq. Mayús.</code> o <code>Shift</code> o <code>Alt Gr</code>, se debe cambiar la variante del teclado actual. Para ello, existen las variantes <code>caps</code> para las mayúsculas, <code>shift</code> para los símbolos de la tecla <code>Shift</code> y <code>altgr</code> para los símbolos que aparecen cuando se pulsa la tecla <code>AltGr</code>. Añadir a estas teclas especiales el evento adecuado para que se ejecute la función <code>pulsaTeclaEspecial()</code> en la que se deben realizar las tareas que correspondan a cada tecla. Además, debería crearse una variable global llamada <code>estado</code> que almacene en todo momento el estado de pulsación de estas teclas especiales, ya que el resultado no es el mismo si se pulsa la tecla de mayúsculas estando o no estando pulsada anteriormente.</p>

<p>7) Una vez configurado el script básico del teclado virtual, se van a añadir los elementos relativos a la comunicación con el servidor. En primer lugar, al cargar la página se muestran en una lista desplegable todos los idiomas disponibles. El script del servidor se llama <code>tecladoVirtual.php</code> y el envío de parámetros se realiza mediante <code>POST</code>. Para cargar los idiomas disponibles, el parámetro que se debe utilizar es <code>accion</code> y su valor es <code>listaIdiomas</code>. La respuesta del servidor es un objeto JSON con los códigos y nombres de cada idioma, además del código del idioma que se carga al principio:</p>

<div class="code javascript">
<pre class="javascript"><span class="br0">&#123;</span> idiomas<span class="sy0">:</span> <span class="br0">&#123;</span>es<span class="sy0">:</span> <span class="st0">&quot;Español&quot;</span><span class="sy0">,</span> de<span class="sy0">:</span> <span class="st0">&quot;Alemán&quot;</span><span class="sy0">,</span> ru<span class="sy0">:</span> <span class="st0">&quot;Ruso&quot;</span><span class="sy0">,</span> el<span class="sy0">:</span> <span class="st0">&quot;Griego&quot;</span><span class="sy0">,</span> ...<span class="br0">&#125;</span><span class="sy0">,</span>
  defecto<span class="sy0">:</span> <span class="st0">&quot;es&quot;</span> <span class="br0">&#125;</span></pre>
</div>

<div class="figure" id="figure_8_7">
    <img src="../../img/ajax/f0807.gif" alt="Lista desplegable con los idiomas disponibles para el teclado virtual" />

    <p class="caption"><strong>Figura 8.7</strong> Lista desplegable con los idiomas disponibles para el teclado virtual</p>
</div>


<p>8) Cuando se cambie el idioma en la lista desplegable, se debe cargar automáticamente el teclado correspondiente a ese idioma. El primer teclado que se muestra al cargar la página es el correspondiente al idioma por defecto indicado por el servidor.</p>

<p>Los teclados de cada idioma con todas sus variantes también se descargan desde el servidor. El script es <code>tecladoVirtual.php</code>, en este caso la acción es <code>cargaTeclado</code> y se debe pasar otro parámetro llamado <code>idioma</code> con el código del idioma cuyo teclado se quiere cargar desde el servidor.</p>

<p>La respuesta del servidor es la siguiente:</p>

<div class="code javascript">
<pre class="javascript"><span class="br0">&#123;</span> normal<span class="sy0">:</span> <span class="br0">&#91;</span><span class="st0">&quot;&amp;#x00BA;&quot;</span><span class="sy0">,</span> <span class="st0">&quot;&amp;#x0031;&quot;</span><span class="sy0">,</span> <span class="st0">&quot;&amp;#x0032;&quot;</span><span class="sy0">,</span> <span class="st0">&quot;&amp;#x0033;&quot;</span><span class="sy0">,</span> <span class="st0">&quot;&amp;#x0034;&quot;</span><span class="sy0">,</span> <span class="st0">&quot;&amp;#x0035;&quot;</span><span class="sy0">,</span> <span class="st0">&quot;&amp;#x0036;&quot;</span><span class="sy0">,</span> ...<span class="sy0">,</span> <span class="st0">&quot;&amp;#x002E;&quot;</span><span class="sy0">,</span> <span class="st0">&quot;&amp;#x002D;&quot;</span><span class="br0">&#93;</span><span class="sy0">,</span>
 caps<span class="sy0">:</span> <span class="br0">&#91;</span><span class="st0">&quot;&amp;#x00BA;&quot;</span><span class="sy0">,</span> <span class="st0">&quot;&amp;#x0031;&quot;</span><span class="sy0">,</span> <span class="st0">&quot;&amp;#x0032;&quot;</span><span class="sy0">,</span> <span class="st0">&quot;&amp;#x0033;&quot;</span><span class="sy0">,</span> <span class="st0">&quot;&amp;#x0034;&quot;</span><span class="sy0">,</span> <span class="st0">&quot;&amp;#x0035;&quot;</span><span class="sy0">,</span> <span class="st0">&quot;&amp;#x0036;&quot;</span><span class="sy0">,</span> ...<span class="sy0">,</span> <span class="st0">&quot;&amp;#x002E;&quot;</span><span class="sy0">,</span> <span class="st0">&quot;&amp;#x002D;&quot;</span><span class="br0">&#93;</span><span class="sy0">,</span>
shift<span class="sy0">:</span> <span class="br0">&#91;</span><span class="st0">&quot;&amp;#x00AA;&quot;</span><span class="sy0">,</span> <span class="st0">&quot;&amp;#x0021;&quot;</span><span class="sy0">,</span> <span class="st0">&quot;&amp;#x0022;&quot;</span><span class="sy0">,</span> <span class="st0">&quot;&amp;#x0027;&quot;</span><span class="sy0">,</span> <span class="st0">&quot;&amp;#x0024;&quot;</span><span class="sy0">,</span> <span class="st0">&quot;&amp;#x0025;&quot;</span><span class="sy0">,</span> <span class="st0">&quot;&amp;#x0026;&quot;</span><span class="sy0">,</span> ...<span class="sy0">,</span> <span class="st0">&quot;&amp;#x003A;&quot;</span><span class="sy0">,</span> <span class="st0">&quot;&amp;#x005F;&quot;</span><span class="br0">&#93;</span><span class="sy0">,</span>
altgr<span class="sy0">:</span> <span class="br0">&#91;</span><span class="st0">&quot;&amp;#x005C;&quot;</span><span class="sy0">,</span> <span class="st0">&quot;&amp;#x007C;&quot;</span><span class="sy0">,</span> <span class="st0">&quot;&amp;#x0040;&quot;</span><span class="sy0">,</span> <span class="st0">&quot;&amp;#x0023;&quot;</span><span class="sy0">,,,</span> <span class="st0">&quot;&amp;#x00AC;&quot;</span><span class="sy0">,,,,,,,,</span>
<span class="sy0">,,,,,,,,,</span> <span class="st0">&quot;&amp;#x005B;&quot;</span><span class="sy0">,</span><span class="st0">&quot;&amp;#x005D;&quot;</span><span class="sy0">,,,,,,,,,,,</span> <span class="st0">&quot;&amp;#x007B;&quot;</span><span class="sy0">,</span> <span class="st0">&quot;&amp;#x007D;&quot;</span><span class="sy0">,,,,,,,,,,</span><span class="st0">&quot;&quot;</span><span class="br0">&#93;</span> <span class="br0">&#125;</span></pre>
</div>

<div class="figure" id="figure_8_8">
    <img src="../../img/ajax/f0808.gif" alt="Detalle del teclado para el idioma ruso y la variante &quot;normal&quot;" />

    <p class="caption"><strong>Figura 8.8</strong> Detalle del teclado para el idioma ruso y la variante &quot;normal&quot;</p>
</div>


<div class="figure" id="figure_8_9">
    <img src="../../img/ajax/f0809.gif" alt="Detalle del teclado para el idioma griego y la variante &quot;normal&quot;" />

    <p class="caption"><strong>Figura 8.9</strong> Detalle del teclado para el idioma griego y la variante &quot;normal&quot;</p>
</div>


<p>Si se utiliza <code>net.CargadorContenidoscompleto</code>, puede ser útil emplear el último parámetro que indica si la petición al servidor es síncrona o asíncrona. En este caso, debería ser síncrona, ya que el resto del programa no puede seguir trabajando hasta que se haya cargado completamente el teclado solicitado.</p>

<p>9) Por último, se va a añadir la característica de autoguardado. Para ello, cada 30 segundos se envía el contenido del usuario al servidor para almacenarlo de forma segura. El servidor devuelve el texto que ha guardado y se muestra en la página para comprar el texto del usuario y el texto guardado. El script del servidor se llama <code>tecladoVirtual.php</code>, la acción es <code>guardar</code> y el parámetro <code>contenido</code> es el que indica el contenido creado por el usuario.</p>

<p>10) Se puede añadir una pequeña mejora visual al teclado virtual: existe una clase de CSS llamada <code>pulsada</code> y que se puede utilizar para resaltar de forma clara la tecla que se ha pulsado. Utilizar esa clase para iluminar durante un breve espacio de tiempo la tecla pulsada en cada momento.</p>

<p>11) Otras posibles mejoras: funcionamiento del teclado numérico, funcionamiento de los acentos, manejo de los LED del teclado, etc.</p>

<p><a href="../../ejercicios/ajax/ejercicio18/ejercicio18.zip">Descargar archivo ZIP con la página HTML, las imágenes y el script tecladoVirtual.php</a></p>

<p><a href="../capitulo14/ejercicio_18.html">Ver solución</a></p></div></p>



    <div class="navigation row">
            <a class="span4 prev" href="../capitulo_8.html">&larr; Anterior <span>Capítulo 8. Técnicas básicas con AJAX</span></a>
            
            <a class="span5 next" href="autocompletar.html">Siguiente &rarr; <span>8.3. Autocompletar</span></a>
        </div>
</div>

<div class="span3 side">
<h3 class="underline"><span>Compartir</span></h3>
<ul class="share">
    <li><a class="twitter" id="share_twitter" href="#" title="Compartir este artículo en Twitter">tw</a></li>
    <li><a class="facebook" id="share_facebook" href="#" title="Compartir este artículo en Facebook">fb</a></li>
    <li><a class="google" id="share_google" href="#" title="Compartir este artículo en Google+">g+</a></li>
</ul>

<script type="text/javascript">
var title    = 'Teclado virtual (Introducción a AJAX%29';
var page_url = encodeURIComponent(window.location);
var options  = 'menubar=no,toolbar=no,resizable=yes,scrollbars=no,width=640,height=350';
var services = {
    share_twitter:  'https://twitter.com/share?text=' + title + '&lang=es&hashtags=librosweb',
    share_facebook: 'http://www.facebook.com/sharer.php?u=' + page_url + '&t=' + title,
    share_google:   'https://plus.google.com/share?url=' + page_url + '&hl=es'
};

for (var id in services) { // don't use services.keys() for compatibility reasons
    if (services.hasOwnProperty(id)) {
        document.getElementById(id).href = services[id];
        document.getElementById(id).onclick = function(a) {
            a = a || window.event;
            a = a.target || a.srcElement;
            _gaq.push(['_trackEvent', 'share', a.id.substr(6), 'Introducción a AJAX : Teclado virtual']);
            window.open(services[a.id], a.title, options);

            return false;
        };
    }
}
</script>

<h3 class="underline"><span>Indice de contenidos</span></h3>
<ul class="toc">
    <li class="level-1">
        <span>1</span> <a href="../capitulo_1.html"> Introducción a AJAX</a>
    </li>
    <li class="level-1">
        <span>2</span> <a href="../capitulo_2.html"> JavaScript básico</a>
    </li>
    <li class="level-1">
        <span>3</span> <a href="../capitulo_3.html"> JavaScript avanzado</a>
    </li>
    <li class="level-1">
        <span>4</span> <a href="../capitulo_4.html"> DOM (Document Object Model)</a>
    </li>
    <li class="level-1">
        <span>5</span> <a href="../capitulo_5.html"> BOM (Browser Object Model)</a>
    </li>
    <li class="level-1">
        <span>6</span> <a href="../capitulo_6.html"> Eventos</a>
    </li>
    <li class="level-1">
        <span>7</span> <a href="../capitulo_7.html"> Primeros pasos con AJAX</a>
    </li>
    <li class="level-1 ">
        <a href="../capitulo_8.html">
            <span>Capítulo 8.</span> Técnicas básicas con AJAX
        </a>
    </li>
    <li class="level-2 active">
        <a href="teclado_virtual.html">
            <span>8.2.</span> Teclado virtual
        </a>
    </li>
    <li class="level-2 ">
        <a href="autocompletar.html">
            <span>8.3.</span> Autocompletar
        </a>
    </li>
    <li class="level-1">
        <span>9</span> <a href="../capitulo_9.html"> Técnicas avanzadas con AJAX</a>
    </li>
    <li class="level-1">
        <span>10</span> <a href="../capitulo_10.html"> Frameworks y librerías</a>
    </li>
    <li class="level-1">
        <span>11</span> <a href="../capitulo_11.html"> Otras utilidades</a>
    </li>
    <li class="level-1">
        <span>12</span> <a href="../capitulo_12.html"> Recursos útiles</a>
    </li>
    <li class="level-1">
        <span>13</span> <a href="../capitulo_13.html"> Bibliografía</a>
    </li>
    <li class="level-1">
        <span>14</span> <a href="../capitulo_14.html"> Ejercicios resueltos</a>
    </li>
</ul>
</div>
        </div></div>
        <div id="footer" class="row">
            <span class="span6">&copy; 2013 LibrosWeb.es 
            <a href="../../contacto/index.html">Contacto</a></span>
            <span class="span6 version">2.340 días online</span>
        </div>
    </div>
    </body>
</html>

<!-- Localized -->