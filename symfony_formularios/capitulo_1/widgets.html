<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <title>1.2. Widgets (Los formularios de Symfony 1.4)</title>
        <link href="../../css/main-fa23fb7.css" rel="stylesheet" type="text/css" />
        <script type="text/javascript">
            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-82842-2']);
            _gaq.push(['_trackPageview']);

            (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
            })();
        </script>
        <link rel="apple-touch-icon" type="image/png" href="../../apple-touch-icon.png" />
        <link rel="apple-touch-icon-precomposed" type="image/png" href="../../apple-touch-icon.png" />
        <meta name="apple-mobile-web-app-title" content="LibrosWeb" />

        <link rel="shortcut icon" type="image/png" href="../../favicon.png" />
        <meta name="site:version" content="fa23fb7" />
        <link rel="author" href="https://plus.google.com/u/0/107307901774377088868" />
        <link rel="prev" href="antes_de_empezar.html" />
        <link rel="next" href="configurando_los_widgets.html" />
        <link rel="start" href="../index.html" />
        <meta name="twitter:site" content="@librosweb" />
        <link rel="search" type="application/opensearchdescription+xml" href="http://librosweb.es/opensearch/documentation.xml" title="Libros y tutoriales de LibrosWeb.es" />
        <meta property="fb:page_id" content="437758756273955" />
        <meta property="fb:app_id" content="437758756273955" />
        <meta property="og:type" content="website" />
        <meta property="og:title" content="1.2. Widgets (Los formularios de Symfony 1.4)" />
        <meta property="og:image" content="http://www.gravatar.com/avatar/9f219b4dfaa677bfd0f47753c02d5126.png?s=200" />
        <meta name="msapplication-TileColor" content="#CC1414" />
        <meta name="application-name" content="LibrosWeb" />
        <meta name="msapplication-tooltip" content="Libros y tutoriales sobre HTML, CSS, JavaScript, PHP y otras tecnologías web." />
    </head>
    <body class="book_page symfony_formularios">
    <div id="container" class="container">
        <div id="header">
            <h1><a href="../../index.html" title="LibrosWeb.es">LibrosWeb</a></h1>
            <form action="/buscar"><input type="text" placeholder="buscar..." name="q"/></form>
        </div>
        <div id="content"><div class="row">
        <ul class="breadcrumbs span12">
  <li><a href="../../index.html">Inicio</a></li>
  <li><a href="../index.html">Los formularios de Symfony 1.4</a></li>
  <li><a href="../capitulo_1.html">Capítulo 1. Creación de formularios</a></li>
  <li class="current"><span>1.2.. Widgets</span></li>
</ul>

<div class="span9">
    <h1 id="widgets"><span>1.2.</span> Widgets</h1>
    

<h3 id="las_clases_sfform_y_sfwidget">1.2.1. Las clases sfForm y sfWidget</h3>

<p>Los usuarios introducen la información en los campos de los formularios. En Symfony un formulario es un objeto que hereda de la clase <code>sfForm</code>. En nuestro ejemplo vamos a crear una clase llamada <code>ContactoForm</code> y que hereda de la clase <code>sfForm</code>.</p>

<div class="admonition note"><p><strong class="title">Nota</strong> <code>sfForm</code> es la clase base de todos los formularios y simplifica la gestión de su flujo de trabajo.</p></div>

<p>Para empezar a configurar el formulario, se añaden <strong>widgets</strong> mediante el método <code>configure()</code>.</p>

<p>Un <strong>widget</strong> representa un campo del formulario. En nuestro ejemplo tenemos que añadir tres widgets, que son los tres campos del formulario: <code>nombre</code>, <code>email</code> y <code>mensaje</code>. El listado 1-1 muestra la primera versión de la clase <code>ContactoForm</code>.</p>

<p><strong>Listado 1-1 - La clase <code>ContactoForm</code> con tres campos</strong></p>

<div class="code php">
<pre class="php"><span class="co1">// lib/form/ContactoForm.class.php</span>
<span class="kw2">class</span> ContactoForm <span class="kw2">extends</span> sfForm
<span class="br0">&#123;</span>
  <span class="kw2">public</span> <span class="kw2">function</span> configure<span class="br0">&#40;</span><span class="br0">&#41;</span>
  <span class="br0">&#123;</span>
    <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">setWidgets</span><span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span>
      <span class="st_h">'nombre'</span>    <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfWidgetFormInput<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span>
      <span class="st_h">'email'</span>     <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfWidgetFormInput<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span>
      <span class="st_h">'mensaje'</span>   <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfWidgetFormTextarea<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span>
    <span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</div>

<p>Los widgets se definen en el método <code>configure()</code>. Este método se invoca automáticamente desde el constructor de la clase <code>sfForm</code>.</p>

<p>El método <code>setWidgets()</code> se utiliza para definir los widgets del formulario. Este método acepta como parámetro un array asociativo en el que las claves son los nombres de los campos y los valores son los objetos de tipo widget. Cada widget es un objeto que hereda de la clase <code>sfWidget</code>. En el ejemplo anterior se han utilizado dos tipos de widgets:</p>

<ul>
<li><code>sfWidgetFormInput</code>: este widget representa un campo de tipo <code>&lt;input&gt;</code></li>
<li><code>sfWidgetFormTextarea</code>: este widget representa un campo de tipo <code>&lt;textarea&gt;</code> </li>
</ul>

<div class="admonition note"><p><strong class="title">Nota</strong> Las clases de los formularios se guardan por convención en el directorio <code>lib/form/</code>. No obstante, puedes guardar los formularios en cualquier otro directorio incluido en el mecanismo de carga automática de clases de Symfony. Más adelante se verá que el propio framework utiliza el directorio <code>lib/form/</code> para generar automáticamente los formularios a partir de los objetos del modelo.</p></div>

<h3 id="visualizando_el_formulario">1.2.2. Visualizando el formulario</h3>

<p>Nuestro formulario ya está listo para ser utilizado. A continuación se crea un módulo en la aplicación para visualizar el formulario:</p>

<div class="code cli">
<pre class="cli">$ cd /ruta/hasta/el/proyecto
$ php symfony generate:module frontend contacto</pre>
</div>

<p>En el módulo <code>contacto</code> se modifica la acción <code>index</code> para pasar una instancia del formulario a la plantilla, tal y como se muestra en el listado 1-2.</p>

<p><strong>Listado 1-2 - La clase de las acciones del módulo <code>contacto</code></strong></p>

<div class="code php">
<pre class="php"><span class="co1">// apps/frontend/modules/contacto/actions/actions.class.php</span>
<span class="kw2">class</span> contactoActions <span class="kw2">extends</span> sfActions
<span class="br0">&#123;</span>
  <span class="kw2">public</span> <span class="kw2">function</span> executeIndex<span class="br0">&#40;</span><span class="br0">&#41;</span>
  <span class="br0">&#123;</span>
    <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">formulario</span> <span class="sy0">=</span> <span class="kw2">new</span> ContactoForm<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</div>

<p>Al crear un formulario mediante <code>new ContactoForm()</code>, se invoca automáticamente el método <code>configure()</code> definido anteriormente.</p>

<p>Ahora ya sólo es necesario crear una plantilla como la del listado 1-3 para visualizar el formulario.</p>

<p><strong>Listado 1-3 - La plantilla utilizada para visualizar el formulario</strong></p>

<div class="code php">
<pre class="php">// apps/frontend/modules/contacto/templates/indexSuccess.php
&lt;form action=&quot;<span class="kw2">&lt;?php</span> <span class="kw1">echo</span> url_for<span class="br0">&#40;</span><span class="st_h">'contacto/enviar'</span><span class="br0">&#41;</span> <span class="sy1">?&gt;</span>&quot; method=&quot;POST&quot;&gt;
  &lt;table&gt;
    <span class="kw2">&lt;?php</span> <span class="kw1">echo</span> <span class="re0">$formulario</span> <span class="sy1">?&gt;</span>
    &lt;tr&gt;
      &lt;td colspan=&quot;2&quot;&gt;
        &lt;input type=&quot;submit&quot; /&gt;
      &lt;/td&gt;
    &lt;/tr&gt;
  &lt;/table&gt;
&lt;/form&gt;</pre>
</div>

<p>Los formularios de Symfony sólo se encargan de los widgets que muestran la información a los usuarios. En la plantilla <code>indexSuccess</code>, la línea <code>&lt;?php echo $formulario ?&gt;</code> sólo muestra los tres campos del formulario. El resto de elementos, como la etiqueta <code>&lt;form&gt;</code> y el botón de envío, los debe añadir el programador. Aunque este comportamiento puede parecer poco intuitivo al principio, pronto se verá lo útil y sencillo que es para crear formularios más complejos.</p>

<p>Utilizar la instrucción <code>&lt;?php echo $formulario ?&gt;</code> es muy útil para crear prototipos y definir formularios. Permite a los programadores concentrarse en la lógica de la aplicación sin preocuparse de los detalles gráficos. El capítulo tres explica cómo personalizar la plantilla y el diseño del formulario.</p>

<div class="admonition note"><p><strong class="title">Nota</strong> Cuando se muestra un objecto usando <code>&lt;?php echo $formulario ?&gt;</code>, el intérprete de PHP muestra la representación en texto del objeto <code>$formulario</code>. Para convertir el objeto en una cadena de texto, PHP intenta ejecutar el método mágico <code>__toString()</code>. Todos los widgets implementan este método para convertir el objeto en código HTML. Por lo tanto, ejecutar <code>&lt;?php echo $formulario ?&gt;</code> es equivalente a ejecutar <code>&lt;?php echo $formulario-&gt;__toString() ?&gt;</code>.</p></div>

<p>Ahora ya es posible visualizar el formulario en un navegador (figura 1-4) y comprobar el resultado accediendo a la dirección de la acción <code>contacto/index</code> (<code>/frontend_dev.php/contacto</code>).</p>

<div class="figure" id="figure_1_4">
    <img src="../../img/symfony_formularios/f0104.png" alt="Formulario de contacto generado" />

    <p class="caption"><strong>Figura 1.4</strong> Formulario de contacto generado</p>
</div>


<p>A continuación se muestra el código HTML generado por la plantilla:</p>

<p><strong>Listado 1-4 Código HTML generado por la plantilla</strong></p>

<div class="code html">
<pre class="html5"><span class="sc2">&lt;<span class="kw2">form</span> <span class="kw3">action</span><span class="sy0">=</span><span class="st0">&quot;/frontend_dev.php/contacto/enviar&quot;</span> <span class="kw3">method</span><span class="sy0">=</span><span class="st0">&quot;POST&quot;</span>&gt;</span>
  <span class="sc2">&lt;<span class="kw2">table</span>&gt;</span>
&nbsp;
    <span class="sc-1">&lt;!-- Código generado por &lt;?php echo $formulario ?&gt; --&gt;</span>
    <span class="sc2">&lt;<span class="kw2">tr</span>&gt;</span>
      <span class="sc2">&lt;<span class="kw2">th</span>&gt;&lt;<span class="kw2">label</span> <span class="kw3">for</span><span class="sy0">=</span><span class="st0">&quot;nombre&quot;</span>&gt;</span>Nombre<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">label</span>&gt;&lt;<span class="sy0">/</span><span class="kw2">th</span>&gt;</span>
      <span class="sc2">&lt;<span class="kw2">td</span>&gt;&lt;<span class="kw2">input</span> <span class="kw3">type</span><span class="sy0">=</span><span class="st0">&quot;text&quot;</span> <span class="kw3">name</span><span class="sy0">=</span><span class="st0">&quot;nombre&quot;</span> <span class="kw3">id</span><span class="sy0">=</span><span class="st0">&quot;nombre&quot;</span> <span class="sy0">/</span>&gt;&lt;<span class="sy0">/</span><span class="kw2">td</span>&gt;</span>
    <span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">tr</span>&gt;</span>
    <span class="sc2">&lt;<span class="kw2">tr</span>&gt;</span>
      <span class="sc2">&lt;<span class="kw2">th</span>&gt;&lt;<span class="kw2">label</span> <span class="kw3">for</span><span class="sy0">=</span><span class="st0">&quot;email&quot;</span>&gt;</span>Email<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">label</span>&gt;&lt;<span class="sy0">/</span><span class="kw2">th</span>&gt;</span>
      <span class="sc2">&lt;<span class="kw2">td</span>&gt;&lt;<span class="kw2">input</span> <span class="kw3">type</span><span class="sy0">=</span><span class="st0">&quot;text&quot;</span> <span class="kw3">name</span><span class="sy0">=</span><span class="st0">&quot;email&quot;</span> <span class="kw3">id</span><span class="sy0">=</span><span class="st0">&quot;email&quot;</span> <span class="sy0">/</span>&gt;&lt;<span class="sy0">/</span><span class="kw2">td</span>&gt;</span>
    <span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">tr</span>&gt;</span>
    <span class="sc2">&lt;<span class="kw2">tr</span>&gt;</span>
      <span class="sc2">&lt;<span class="kw2">th</span>&gt;&lt;<span class="kw2">label</span> <span class="kw3">for</span><span class="sy0">=</span><span class="st0">&quot;mensaje&quot;</span>&gt;</span>Mensaje<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">label</span>&gt;&lt;<span class="sy0">/</span><span class="kw2">th</span>&gt;</span>
      <span class="sc2">&lt;<span class="kw2">td</span>&gt;&lt;<span class="kw2">textarea</span> <span class="kw3">rows</span><span class="sy0">=</span><span class="st0">&quot;4&quot;</span> <span class="kw3">cols</span><span class="sy0">=</span><span class="st0">&quot;30&quot;</span> <span class="kw3">name</span><span class="sy0">=</span><span class="st0">&quot;mensaje&quot;</span> <span class="kw3">id</span><span class="sy0">=</span><span class="st0">&quot;mensaje&quot;</span>&gt;&lt;<span class="sy0">/</span><span class="kw2">textarea</span>&gt;&lt;<span class="sy0">/</span><span class="kw2">td</span>&gt;</span>
    <span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">tr</span>&gt;</span>
    <span class="sc-1">&lt;!-- Fin del código generado por &lt;?php echo $formulario ?&gt; --&gt;</span>
&nbsp;
    <span class="sc2">&lt;<span class="kw2">tr</span>&gt;</span>
      <span class="sc2">&lt;<span class="kw2">td</span> <span class="kw3">colspan</span><span class="sy0">=</span><span class="st0">&quot;2&quot;</span>&gt;</span>
        <span class="sc2">&lt;<span class="kw2">input</span> <span class="kw3">type</span><span class="sy0">=</span><span class="st0">&quot;submit&quot;</span> <span class="sy0">/</span>&gt;</span>
      <span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">td</span>&gt;</span>
    <span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">tr</span>&gt;</span>
  <span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">table</span>&gt;</span>
<span class="sc2">&lt;<span class="sy0">/</span><span class="kw2">form</span>&gt;</span></pre>
</div>

<p>El código HTML generado por el formulario está compuesto de tres filas de tabla (etiqueta <code>&lt;tr&gt;</code>). Por ese motivo el código de la plantilla utilizaba antes una etiqueta <code>&lt;table&gt;</code> para encerrar los contenidos del formulario. Cada fila de formulario incluye una etiqueta <code>&lt;label&gt;</code> y una etiqueta de formulario (<code>&lt;input&gt;</code> o <code>&lt;textarea&gt;</code>).</p>

<h3 id="labels">1.2.3. Labels</h3>

<p>Los títulos o <em>labels</em> de cada campo se generan de forma automática. La lógica que se utiliza por defecto para convertir los nombres de los campos en sus títulos sigue dos reglas:</p>

<ul>
<li>La primera letra se convierte en mayúscula</li>
<li>Los guiones bajos se convierten en espacios en blanco</li>
</ul>

<p>A continuación se muestra otro ejemplo:</p>

<div class="code php">
<pre class="php"><span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">setWidgets</span><span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span>
  <span class="st_h">'codigo_postal'</span>     <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfWidgetFormInput<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="co1">// Título generado: &quot;Codigo postal&quot;</span>
  <span class="st_h">'fecha_nacimiento'</span>  <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfWidgetFormInput<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span> <span class="co1">// Título generado: &quot;Fecha nacimiento&quot;</span>
<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>

<p>Aunque la generación automática de los títulos es muy útil, el framework también permite definir títulos personalizados con el método <code>setLabels()</code>:</p>

<div class="code php">
<pre class="php"><span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">widgetSchema</span><span class="sy0">-&gt;</span><span class="me1">setLabels</span><span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span>
  <span class="st_h">'nombre'</span>  <span class="sy0">=&gt;</span> <span class="st_h">'Tu nombre'</span><span class="sy0">,</span>
  <span class="st_h">'email'</span>   <span class="sy0">=&gt;</span> <span class="st_h">'Tu correo electrónico'</span><span class="sy0">,</span>
  <span class="st_h">'mensaje'</span> <span class="sy0">=&gt;</span> <span class="st_h">'Tu mensaje'</span><span class="sy0">,</span>
<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>

<p>También se puede modificar un solo título mediante el método <code>setLabel()</code>:</p>

<div class="code php">
<pre class="php"><span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">widgetSchema</span><span class="sy0">-&gt;</span><span class="me1">setLabel</span><span class="br0">&#40;</span><span class="st_h">'email'</span><span class="sy0">,</span> <span class="st_h">'Tu correo electrónico'</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>

<p>El capítulo 3 muestra cómo se pueden personalizar los títulos desde la plantilla para personalizar aun más los formularios.</p>

<div class="admonition sidebar"><p><strong class="title">Widget Schema</strong> Cuando se utiliza el método <code>setWidgets()</code>, Symfony crea un objeto de tipo <code>sfWidgetFormSchema</code>. Este objeto es un widget que representa a un conjunto de widgets. En nuestro formulario <code>ContactoForm</code> hemos utilizado el método <code>setWidgets()</code>, que es equivalente al siguiente código:</p>

<div class="code php">
<pre class="php"><span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">setWidgetSchema</span><span class="br0">&#40;</span><span class="kw2">new</span> sfWidgetFormSchema<span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span>
  <span class="st_h">'nombre'</span>  <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfWidgetFormInput<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span>
  <span class="st_h">'email'</span>   <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfWidgetFormInput<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span>
  <span class="st_h">'mensaje'</span> <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfWidgetFormTextarea<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span>
<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
<span class="co1">// es equivalente a:</span>
&nbsp;
<span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">widgetSchema</span> <span class="sy0">=</span> <span class="kw2">new</span> sfWidgetFormSchema<span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span>
  <span class="st_h">'nombre'</span>  <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfWidgetFormInput<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span>
  <span class="st_h">'email'</span>   <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfWidgetFormInput<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span>
  <span class="st_h">'mensaje'</span> <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfWidgetFormTextarea<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span>
<span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>

<p>El método <code>setLabels()</code> se aplica al conjunto de widgets incluídos en el objecto <code>widgetSchema</code>.</p>

<p>En el capítulo 5 se explica por qué el concepto de <em>"schema widget"</em> hace más fácil el manejo de formularios complejos.</p></div>

<h3 id="mas_alla_de_las_tablas_generadas">1.2.4. Más allá de las tablas generadas</h3>

<p>Aunque por defecto el formulario se muestra con una tabla HTML, su diseño se puede modificar completamente. Los diferentes tipos de diseños o <em>layouts</em> se definen en clases que heredan de <code>sfWidgetFormSchemaFormatter</code>. El estilo por defecto de los formularios corresponde a la clase <code>sfWidgetFormSchemaFormatterTable</code>. También es posible utilizar el diseño <code>list</code>, basado en una lista HTML:</p>

<div class="code php">
<pre class="php"><span class="kw2">class</span> ContactoForm <span class="kw2">extends</span> sfForm
<span class="br0">&#123;</span>
  <span class="kw2">public</span> <span class="kw2">function</span> configure<span class="br0">&#40;</span><span class="br0">&#41;</span>
  <span class="br0">&#123;</span>
    <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">setWidgets</span><span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span>
      <span class="st_h">'nombre'</span>  <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfWidgetFormInput<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span>
      <span class="st_h">'email'</span>   <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfWidgetFormInput<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span>
      <span class="st_h">'mensaje'</span> <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfWidgetFormTextarea<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span>
    <span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">widgetSchema</span><span class="sy0">-&gt;</span><span class="me1">setFormFormatterName</span><span class="br0">&#40;</span><span class="st_h">'list'</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</div>

<p>Los diseños de tabla y de lista están incluídos por defecto en Symfony. En el capítulo 5 se explica cómo crear tus propias clases de formato para personalizar el diseño de los formularios. Después de mostrar cómo se visualiza un formulario, el siguiente paso consiste en realizar el envío de los datos introducidos por el usuario.</p>

<h3 id="enviando_el_formulario">1.2.5. Enviando el formulario</h3>

<p>Al crear la plantilla que muestra el formulario, se empleó la URL interna <code>contacto/enviar</code> en la etiqueta <code>&lt;form&gt;</code> para enviar el formulario. Por tanto, el siguiente paso consiste en añadir la acción <code>enviar</code> en el módulo <code>contacto</code>. El listado 1-5 muestra cómo obtener en la acción la información enviada por el usuario y cómo se le puede redirigir a la página de agradecimiento, donde se vuelve a mostrar la misma información.</p>

<p><strong>Listado 1-5 - La acción <code>enviar</code> en el módulo <code>contacto</code></strong></p>

<div class="code php">
<pre class="php"><span class="kw2">public</span> <span class="kw2">function</span> executeEnviar<span class="br0">&#40;</span><span class="re0">$request</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
  <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">forward404Unless</span><span class="br0">&#40;</span><span class="re0">$request</span><span class="sy0">-&gt;</span><span class="me1">isMethod</span><span class="br0">&#40;</span><span class="st_h">'post'</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
  <span class="re0">$parametros</span> <span class="sy0">=</span> <span class="kw3">array</span><span class="br0">&#40;</span>
    <span class="st_h">'nombre'</span>  <span class="sy0">=&gt;</span> <span class="re0">$request</span><span class="sy0">-&gt;</span><span class="me1">getParameter</span><span class="br0">&#40;</span><span class="st_h">'nombre'</span><span class="br0">&#41;</span><span class="sy0">,</span>
    <span class="st_h">'email'</span>   <span class="sy0">=&gt;</span> <span class="re0">$request</span><span class="sy0">-&gt;</span><span class="me1">getParameter</span><span class="br0">&#40;</span><span class="st_h">'email'</span><span class="br0">&#41;</span><span class="sy0">,</span>
    <span class="st_h">'mensaje'</span> <span class="sy0">=&gt;</span> <span class="re0">$request</span><span class="sy0">-&gt;</span><span class="me1">getParameter</span><span class="br0">&#40;</span><span class="st_h">'mensaje'</span><span class="br0">&#41;</span><span class="sy0">,</span>
  <span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
  <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">redirect</span><span class="br0">&#40;</span><span class="st_h">'contacto/gracias?'</span><span class="sy0">.</span><span class="kw3">http_build_query</span><span class="br0">&#40;</span><span class="re0">$parametros</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw2">public</span> <span class="kw2">function</span> executeGracias<span class="br0">&#40;</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
<span class="br0">&#125;</span></pre>
</div>

<div class="code php">
<pre class="php">// apps/frontend/modules/contacto/templates/graciasSuccess.php
&lt;ul&gt;
  &lt;li&gt;Nombre:  <span class="kw2">&lt;?php</span> <span class="kw1">echo</span> <span class="re0">$sf_params</span><span class="sy0">-&gt;</span><span class="me1">get</span><span class="br0">&#40;</span><span class="st_h">'nombre'</span><span class="br0">&#41;</span> <span class="sy1">?&gt;</span>&lt;/li&gt;
  &lt;li&gt;Email:   <span class="kw2">&lt;?php</span> <span class="kw1">echo</span> <span class="re0">$sf_params</span><span class="sy0">-&gt;</span><span class="me1">get</span><span class="br0">&#40;</span><span class="st_h">'email'</span><span class="br0">&#41;</span> <span class="sy1">?&gt;</span>&lt;/li&gt;
  &lt;li&gt;Mensaje: <span class="kw2">&lt;?php</span> <span class="kw1">echo</span> <span class="re0">$sf_params</span><span class="sy0">-&gt;</span><span class="me1">get</span><span class="br0">&#40;</span><span class="st_h">'mensaje'</span><span class="br0">&#41;</span> <span class="sy1">?&gt;</span>&lt;/li&gt;
&lt;/ul&gt;</pre>
</div>

<div class="admonition note"><p><strong class="title">Nota</strong> <code>http_build_query</code> es una función propia de PHP que genera una cadena de texto de tipo <em>query string</em> a partir de los parámetros pasados a través de un array y con sus valores correctamente codificados para incluirlos en una URL.</p></div>

<p>El método <code>executeEnviar()</code> realiza tres acciones:</p>

<ul>
<li>Por razones de seguridad, se comprueba que la página se ha enviado utilizando el método <code>POST</code>. Si no es así, se redirige al usuario a una página de error <code>404</code>. En la plantilla <code>indexSuccess</code>, se había declarado que el método de envío del formulario debe ser <code>POST</code> (<code>&lt;form ... method="POST"&gt;</code>):</li>
</ul>

<div class="code php">
<pre class="php"><span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">forward404Unless</span><span class="br0">&#40;</span><span class="re0">$request</span><span class="sy0">-&gt;</span><span class="me1">isMethod</span><span class="br0">&#40;</span><span class="st_h">'post'</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>

<ul>
<li>A continuación se obtienen los valores introducidos por el usuario y se guardan en un array llamado <code>parametros</code>:</li>
</ul>

<div class="code php">
<pre class="php"><span class="re0">$parametros</span> <span class="sy0">=</span> <span class="kw3">array</span><span class="br0">&#40;</span>
  <span class="st_h">'nombre'</span>  <span class="sy0">=&gt;</span> <span class="re0">$request</span><span class="sy0">-&gt;</span><span class="me1">getParameter</span><span class="br0">&#40;</span><span class="st_h">'nombre'</span><span class="br0">&#41;</span><span class="sy0">,</span>
  <span class="st_h">'email'</span>   <span class="sy0">=&gt;</span> <span class="re0">$request</span><span class="sy0">-&gt;</span><span class="me1">getParameter</span><span class="br0">&#40;</span><span class="st_h">'email'</span><span class="br0">&#41;</span><span class="sy0">,</span>
  <span class="st_h">'mensaje'</span> <span class="sy0">=&gt;</span> <span class="re0">$request</span><span class="sy0">-&gt;</span><span class="me1">getParameter</span><span class="br0">&#40;</span><span class="st_h">'mensaje'</span><span class="br0">&#41;</span><span class="sy0">,</span>
<span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>

<ul>
<li>Por último, se redirige al usuario a la página de agradecimiento (<code>contacto/gracias</code>) para mostrarle la información que ha introducido:</li>
</ul>

<div class="code php">
<pre class="php"><span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">redirect</span><span class="br0">&#40;</span><span class="st_h">'contacto/gracias?'</span><span class="sy0">.</span><span class="kw3">http_build_query</span><span class="br0">&#40;</span><span class="re0">$parametros</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span></pre>
</div>

<p>En vez de redirigir al usuario a otra página, se podría haber creado una plantilla llamada <code>enviarSuccess.php</code>. No obstante, aunque es posible hacerlo, después de un envío por el método <code>POST</code> se recomienda redirigir al usuario a otra página, ya que:</p>

<ul>
<li>Se evita que el usuario envíe de nuevo el formulario si recarga la página de agradecimiento.</li>
<li>El usuario puede volver a la página anterior sin que se le muestre el mensaje de enviar el formulario de nuevo.</li>
</ul>

<div class="admonition note"><p><strong class="title">Nota</strong> Quizás has observado que el método <code>executeEnviar()</code> es diferente de <code>executeIndex()</code>. Cuando se invocan estos dos métodos, Symfony les pasa automáticamente como primer argumento el objeto de tipo <code>sfRequest</code> que representa a la petición actual. Como en PHP no es necesario recoger todos los parámetros que se pasan a una función, el método <code>executeIndex()</code> no incluye el parámetro <code>$request</code> en su definición, ya que no lo utiliza para nada.</p></div>

<p>La figura 1-5 muestra el flujo de trabajo de todos los métodos que intervienen en la interacción del usuario.</p>

<div class="figure" id="figure_1_5">
    <img src="../../img/symfony_formularios/f0105.png" alt="Flujo de trabajo de los métodos" />

    <p class="caption"><strong>Figura 1.5</strong> Flujo de trabajo de los métodos</p>
</div>


<div class="admonition note"><p><strong class="title">Nota</strong> Cuando se vuelve a mostrar la información del usuario en la plantilla, se corre el riesgo de sufrir un ataque de tipo XSS  <em>Cross-Site Scripting</em>). Puedes consultar el <a href="../../symfony_1_4/capitulo-7.html">capítulo sobre la parte de la vista</a> del libro oficial de Symfony para conocer más detalles sobre cómo evitar los ataques XSS.</p></div>

<p>Después de enviar el formulario, deberías ver la página de la figura 1-6.</p>

<div class="figure" id="figure_1_6">
    <img src="../../img/symfony_formularios/f0106.png" alt="Página que se muestra después de enviar el formulario" />

    <p class="caption"><strong>Figura 1.6</strong> Página que se muestra después de enviar el formulario</p>
</div>


<p>Por otra parte, en vez de crear el array <code>parametros</code>, sería más sencillo recoger la información del usuario directamente en un array. El listado 1-6 modifica el atributo <code>name</code> de HTML de los widgets para guardar los valores en un array llamado <code>contacto</code>.</p>

<p><strong>Listado 1-6 - Modificando el atributo <code>name</code> de HTML de los widgets</strong></p>

<div class="code php">
<pre class="php"><span class="kw2">class</span> ContactoForm <span class="kw2">extends</span> sfForm
<span class="br0">&#123;</span>
  <span class="kw2">public</span> <span class="kw2">function</span> configure<span class="br0">&#40;</span><span class="br0">&#41;</span>
  <span class="br0">&#123;</span>
    <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">setWidgets</span><span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span>
      <span class="st_h">'nombre'</span>  <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfWidgetFormInput<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span>
      <span class="st_h">'email'</span>   <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfWidgetFormInput<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span>
      <span class="st_h">'mensaje'</span> <span class="sy0">=&gt;</span> <span class="kw2">new</span> sfWidgetFormTextarea<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span>
    <span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">widgetSchema</span><span class="sy0">-&gt;</span><span class="me1">setNameFormat</span><span class="br0">&#40;</span><span class="st_h">'contacto[%s]'</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</div>

<p>El método <code>setNameFormat()</code> permite modificar el atributo <code>name</code> en todos los widgets. Cuando se genera el formulario, el valor <code>%s</code> se reemplaza automáticamente por el nombre de cada campo. Si se toma como ejemplo el campo <code>email</code>, su atributo <code>name</code> de HTML será <code>contacto[email]</code>. Si se utilizan estos nombres, PHP crea automáticamente un array que incluye todos los valores enviados en la petición. De esta forma, los valores de los campos se pueden acceder mediante el array <code>contacto</code>.</p>

<p>Ahora en la acción se puede obtener el array <code>contacto</code> directamente a partir del objeto de la petición, tal y como se muestra en el listado 1-7.</p>

<p><strong>Listado 1-7 - Nuevo formato de los atributos <code>name</code> de los widgets</strong></p>

<div class="code php">
<pre class="php"><span class="kw2">public</span> <span class="kw2">function</span> executeEnviar<span class="br0">&#40;</span><span class="re0">$request</span><span class="br0">&#41;</span>
<span class="br0">&#123;</span>
  <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">forward404Unless</span><span class="br0">&#40;</span><span class="re0">$request</span><span class="sy0">-&gt;</span><span class="me1">isMethod</span><span class="br0">&#40;</span><span class="st_h">'post'</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
  <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">redirect</span><span class="br0">&#40;</span><span class="st_h">'contacto/gracias?'</span><span class="sy0">.</span><span class="kw3">http_build_query</span><span class="br0">&#40;</span><span class="re0">$request</span><span class="sy0">-&gt;</span><span class="me1">getParameter</span><span class="br0">&#40;</span><span class="st_h">'contacto'</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
<span class="br0">&#125;</span></pre>
</div>

<p>Si observas el código HTML del formulario generado, verás que Symfony no sólo crea un atributo <code>name</code> a partir del nombre y formato de cada widget, sino que también crea un atributo <code>id</code>. En realidad, el atributo <code>id</code> es una copia del atributo <code>name</code> en la que se han sustituido los caracteres problemáticos por un guión bajo (<code>_</code>):</p>

<div class="table" id="table_1_1">

    <table>
<thead>
<tr>
  <th>Nombre del widget</th>
  <th>Atributo <code>name</code></th>
  <th>Atributo <code>id</code></th>
</tr>
</thead>
<tbody>
<tr>
  <td><code>nombre</code></td>
  <td><code>contacto[nombre]</code></td>
  <td>contacto_nombre</td>
</tr>
<tr>
  <td><code>email</code></td>
  <td><code>contacto[email]</code></td>
  <td>contacto_email</td>
</tr>
<tr>
  <td><code>mensaje</code></td>
  <td><code>contacto[mensaje]</code></td>
  <td>contacto_mensaje</td>
</tr>
</tbody>
</table>
</div>


<h3 id="una_solucion_alternativa">1.2.6. Una solución alternativa</h3>

<p>En el ejemplo anterior se utilizan dos acciones para gestionar el formulario: acción <code>index</code> para mostrarlo y acción <code>enviar</code> para enviarlo. Como el formulario se visualiza con el método <code>GET</code> y se envía con el método <code>POST</code>, se pueden fusionar los dos métodos en una única acción <code>index</code> como se muestra en el listado 1-8.</p>

<p><strong>Listado 1-8 - Fusionando las dos acciones utilizadas en el formulario</strong></p>

<div class="code php">
<pre class="php"><span class="kw2">class</span> contactoActions <span class="kw2">extends</span> sfActions
<span class="br0">&#123;</span>
  <span class="kw2">public</span> <span class="kw2">function</span> executeIndex<span class="br0">&#40;</span><span class="re0">$request</span><span class="br0">&#41;</span>
  <span class="br0">&#123;</span>
    <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">formulario</span> <span class="sy0">=</span> <span class="kw2">new</span> ContactoForm<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    <span class="kw1">if</span> <span class="br0">&#40;</span><span class="re0">$request</span><span class="sy0">-&gt;</span><span class="me1">isMethod</span><span class="br0">&#40;</span><span class="st_h">'post'</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
    <span class="br0">&#123;</span>
      <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">redirect</span><span class="br0">&#40;</span><span class="st_h">'contacto/gracias?'</span><span class="sy0">.</span><span class="kw3">http_build_query</span><span class="br0">&#40;</span><span class="re0">$request</span><span class="sy0">-&gt;</span><span class="me1">getParameter</span><span class="br0">&#40;</span><span class="st_h">'contacto'</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="br0">&#125;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</div>

<p>Para que el código anterior funcione correctamente, no olvides modificar el atributo <code>action</code> del formulario en la plantilla <code>indexSuccess.php</code>:</p>

<div class="code html">
<pre class="html5"><span class="sc2">&lt;<span class="kw2">form</span> <span class="kw3">action</span><span class="sy0">=</span><span class="st0">&quot;&lt;?php echo url_for('contacto/index') ?&gt;</span></span>&quot; method=&quot;POST&quot;&gt;</pre>
</div>

<p>Como se verá más adelante, es mejor utilizar esta sintaxis porque es más breve y hace que el código resultante sea más coherente y fácil de entender.</p>



    <div class="navigation row">
            <a class="span4 prev" href="antes_de_empezar.html">&larr; Anterior <span>1.1. Antes de empezar</span></a>
            
            <a class="span5 next" href="configurando_los_widgets.html">Siguiente &rarr; <span>1.3. Configurando los widgets</span></a>
        </div>
</div>

<div class="span3 side">
<h3 class="underline"><span>Compartir</span></h3>
<ul class="share">
    <li><a class="twitter" id="share_twitter" href="#" title="Compartir este artículo en Twitter">tw</a></li>
    <li><a class="facebook" id="share_facebook" href="#" title="Compartir este artículo en Facebook">fb</a></li>
    <li><a class="google" id="share_google" href="#" title="Compartir este artículo en Google+">g+</a></li>
</ul>

<script type="text/javascript">
var title    = 'Widgets (Los formularios de Symfony 1.4%29';
var page_url = encodeURIComponent(window.location);
var options  = 'menubar=no,toolbar=no,resizable=yes,scrollbars=no,width=640,height=350';
var services = {
    share_twitter:  'https://twitter.com/share?text=' + title + '&lang=es&hashtags=librosweb',
    share_facebook: 'http://www.facebook.com/sharer.php?u=' + page_url + '&t=' + title,
    share_google:   'https://plus.google.com/share?url=' + page_url + '&hl=es'
};

for (var id in services) { // don't use services.keys() for compatibility reasons
    if (services.hasOwnProperty(id)) {
        document.getElementById(id).href = services[id];
        document.getElementById(id).onclick = function(a) {
            a = a || window.event;
            a = a.target || a.srcElement;
            _gaq.push(['_trackEvent', 'share', a.id.substr(6), 'Los formularios de Symfony 1.4 : Widgets']);
            window.open(services[a.id], a.title, options);

            return false;
        };
    }
}
</script>

<h3 class="underline"><span>Indice de contenidos</span></h3>
<ul class="toc">
    <li class="level-1 ">
        <a href="../capitulo_1.html">
            <span>Capítulo 1.</span> Creación de formularios
        </a>
    </li>
    <li class="level-2 ">
        <a href="antes_de_empezar.html">
            <span>1.1.</span> Antes de empezar
        </a>
    </li>
    <li class="level-2 active">
        <a href="widgets.html">
            <span>1.2.</span> Widgets
        </a>
    </li>
    <li class="level-2 ">
        <a href="configurando_los_widgets.html">
            <span>1.3.</span> Configurando los widgets
        </a>
    </li>
    <li class="level-1">
        <span>2</span> <a href="../capitulo_2.html"> Validación de formularios</a>
    </li>
    <li class="level-1">
        <span>3</span> <a href="../capitulo_3.html"> Formularios para diseñadores web</a>
    </li>
    <li class="level-1">
        <span>4</span> <a href="../capitulo_4.html"> Integración con Propel</a>
    </li>
    <li class="level-1">
        <span>5</span> <a href="../capitulo_5.html"> Sin título</a>
    </li>
    <li class="level-1">
        <span>6</span> <a href="../capitulo_6.html"> Sin título</a>
    </li>
    <li class="level-1">
        <span>7</span> <a href="../capitulo_7.html"> Sin título</a>
    </li>
    <li class="level-1">
        <span>8</span> <a href="../capitulo_8.html"> Internacionalización y localización</a>
    </li>
    <li class="level-1">
        <span>9</span> <a href="../capitulo_9.html"> Sin título</a>
    </li>
    <li class="level-1">
        <span>10</span> <a href="../capitulo_10.html"> Sin título</a>
    </li>
    <li class="level-1">
        <span>11</span> <a href="../capitulo_11.html"> Integrando Doctrine</a>
    </li>
    <li class="level-1">
        <span>12</span> <a href="../capitulo_12.html"> Referencia de Widgets</a>
    </li>
    <li class="level-1">
        <span>13</span> <a href="../capitulo_13.html"> Validadores</a>
    </li>
</ul>
</div>
        </div></div>
        <div id="footer" class="row">
            <span class="span6">&copy; 2013 LibrosWeb.es 
            <a href="../../contacto/index.html">Contacto</a></span>
            <span class="span6 version">2.340 días online</span>
        </div>
    </div>
    </body>
</html>

<!-- Localized -->