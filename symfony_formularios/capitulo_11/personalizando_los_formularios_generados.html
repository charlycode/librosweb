<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="es" xml:lang="es">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <title>11.4. Personalizando los formularios generados (Los formularios de Symfony 1.4)</title>
        <link href="../../css/main-fa23fb7.css" rel="stylesheet" type="text/css" />
        <script type="text/javascript">
            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-82842-2']);
            _gaq.push(['_trackPageview']);

            (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
            })();
        </script>
        <link rel="apple-touch-icon" type="image/png" href="../../apple-touch-icon.png" />
        <link rel="apple-touch-icon-precomposed" type="image/png" href="../../apple-touch-icon.png" />
        <meta name="apple-mobile-web-app-title" content="LibrosWeb" />

        <link rel="shortcut icon" type="image/png" href="../../favicon.png" />
        <meta name="site:version" content="fa23fb7" />
        <link rel="author" href="https://plus.google.com/u/0/107307901774377088868" />
        <meta name="twitter:site" content="@librosweb" />
        <link rel="search" type="application/opensearchdescription+xml" href="http://librosweb.es/opensearch/documentation.xml" title="Libros y tutoriales de LibrosWeb.es" />
        <meta property="fb:page_id" content="437758756273955" />
        <meta property="fb:app_id" content="437758756273955" />
        <meta property="og:type" content="website" />
        <meta property="og:title" content="11.4. Personalizando los formularios generados (Los formularios de Symfony 1.4)" />
        <meta property="og:image" content="http://www.gravatar.com/avatar/9f219b4dfaa677bfd0f47753c02d5126.png?s=200" />
        <meta name="msapplication-TileColor" content="#CC1414" />
        <meta name="application-name" content="LibrosWeb" />
        <meta name="msapplication-tooltip" content="Libros y tutoriales sobre HTML, CSS, JavaScript, PHP y otras tecnologías web." />
    </head>
    <body class="book_page symfony_formularios">
    <div id="container" class="container">
        <div id="header">
            <h1><a href="../../index.html" title="LibrosWeb.es">LibrosWeb</a></h1>
            <form action="/buscar"><input type="text" placeholder="buscar..." name="q"/></form>
        </div>
        <div id="content"><div class="row">
        <ul class="breadcrumbs span12">
  <li><a href="../../index.html">Inicio</a></li>
  <li><a href="../index.html">Los formularios de Symfony 1.4</a></li>
  <li><a href="../capitulo_11.html">Capítulo 11. Integrando Doctrine</a></li>
  <li class="current"><span>11.4. Personalizando los formularios generados</span></li>
</ul>

<div class="span9">
    <h1 id="personalizando_los_formularios_generados"><span>11.4.</span> Personalizando los formularios generados</h1>
    

<p>Las tareas <code>doctrine:build-forms</code> y <code>doctrine:generate-crud</code> permiten crear módulos de Symfony totalmente funcionales para listar, crear, editar y borrar objetos del modelo de datos. Estos módulos tienen en cuenta las reglas de validación y las relaciones entre tablas. Además, todo esto se consigue sin escribir ni una sola línea de código.</p>

<p>El siguiente paso consiste en personalizar el código generado automáticamente. Como los formularios incluyen muchos elementos, algunos aspectos de cada formulario deben ser modificados.</p>

<h3 id="configurando_los_widgets_y_validadores">11.4.1 Configurando los widgets y validadores</h3>

<p>En primer lugar se configuran los widgets y validadores generados automáticamente. El formulario <code>ArticleForm</code> incluye un campo llamado <code>slug</code>. Un <em>slug</em> es una cadena de caracteres que representan de forma única a cada artículo dentro de la URL.</p>

<p>Si se considera por ejemplo un artículo titulado <em>"Optimiza las aplicaciones creadas con Symfony"</em>, su <em>slug</em> sería <code>12-optimiza-las-aplicaciones-creadas-con-symfony</code>, siendo <code>12</code> el valor del campo <code>id</code> de ese artículo. Normalmente el <em>slug</em> se genera automáticamente a partir del título del objeto cada vez que se guarda el objeto en la base de datos.</p>

<p>En el siguiente ejemplo se considera que el usuario también puede indicar de forma explícita el valor del <em>slug</em> de un artículo. En este caso, aunque es obligatorio que el <em>slug</em> tenga un valor válido, no puede ser un campo obligatorio del formulario. Por este motivo se modificar su validador para que sea opcional, tal y como muestra el listado 11-8. Además, se modifica el campo <code>content</code> para aumentar su tamaño en pantalla y para forzar al usuario a escribir al menos cinco caracteres.</p>

<p><strong>Listado 11-8 - Personalizando widgets y validadores</strong></p>

<div class="code php">
<pre class="php"><span class="kw2">class</span> ArticleForm <span class="kw2">extends</span> BaseArticleForm
<span class="br0">&#123;</span>
  <span class="kw2">public</span> <span class="kw2">function</span> configure<span class="br0">&#40;</span><span class="br0">&#41;</span>
  <span class="br0">&#123;</span>
    <span class="co1">// ...</span>
&nbsp;
    <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">validatorSchema</span><span class="br0">&#91;</span><span class="st_h">'slug'</span><span class="br0">&#93;</span><span class="sy0">-&gt;</span><span class="me1">setOption</span><span class="br0">&#40;</span><span class="st_h">'required'</span><span class="sy0">,</span> <span class="kw4">false</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">validatorSchema</span><span class="br0">&#91;</span><span class="st_h">'content'</span><span class="br0">&#93;</span><span class="sy0">-&gt;</span><span class="me1">setOption</span><span class="br0">&#40;</span><span class="st_h">'min_length'</span><span class="sy0">,</span> <span class="nu0">5</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">widgetSchema</span><span class="br0">&#91;</span><span class="st_h">'content'</span><span class="br0">&#93;</span><span class="sy0">-&gt;</span><span class="me1">setAttributes</span><span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span><span class="st_h">'rows'</span> <span class="sy0">=&gt;</span> <span class="nu0">10</span><span class="sy0">,</span> <span class="st_h">'cols'</span> <span class="sy0">=&gt;</span> <span class="nu0">40</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</div>

<p>El código anterior utiliza los objetos <code>validatorSchema</code> y <code>widgetSchema</code> como si fueran arrays de PHP. Estos arrays asociativos admiten como clave el nombre de un campo del formulario y devuelven respectivamente el objeto validador y el objeto del widget. Mediante estos objetos se personalizan los campos y widgets individualmente.</p>

<div class="admonition note"><p><strong class="title">Nota</strong> Para poder utilizar los objetos como si fueran arrays de PHP, las clases <code>sfValidatorSchema</code> y <code>sfWidgetFormSchema</code> implementan la interfaz <code>ArrayAccess</code>, disponible en PHP desde la versión 5.</p></div>

<p>Para asegurar que dos artículos no tengan el mismo valor en su campo <code>slug</code>, la definición del esquema incluye una restricción que exige que el valor del campo sea único. Esta restricción de la base de datos se refleja en el formulario <code>ArticleForm</code> mediante el validador <code>sfValidatorDoctrineUnique</code>. Este validador permite asegurar que el valor de un campo del formulario sea único en la base de datos. Se puede emplear este validador, entre otras cosas, para asegurar que una dirección de email o un login sean únicos. El listado 11-9 muestra como lo utiliza el formulario <code>ArticleForm</code>.</p>

<p><strong>Listado 11-9 - Utilizando el validador <code>sfValidatorDoctrineUnique</code> para asegurar que un valor sea único</strong></p>

<div class="code php">
<pre class="php"><span class="kw2">class</span> BaseArticleForm <span class="kw2">extends</span> BaseFormDoctrine
<span class="br0">&#123;</span>
  <span class="kw2">public</span> <span class="kw2">function</span> setup<span class="br0">&#40;</span><span class="br0">&#41;</span>
  <span class="br0">&#123;</span>
    <span class="co1">// ...</span>
&nbsp;
    <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">validatorSchema</span><span class="sy0">-&gt;</span><span class="me1">setPostValidator</span><span class="br0">&#40;</span>
      <span class="kw2">new</span> sfValidatorDoctrineUnique<span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span><span class="st_h">'model'</span> <span class="sy0">=&gt;</span> <span class="st_h">'Article'</span><span class="sy0">,</span> <span class="st_h">'column'</span> <span class="sy0">=&gt;</span> <span class="kw3">array</span><span class="br0">&#40;</span><span class="st_h">'slug'</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#41;</span>
    <span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</div>

<p>El validador <code>sfValidatorDoctrineUnique</code> es de tipo <code>postValidator</code>, ya que se ejecuta sobre los datos completos del formulario después de que cada campo individual haya sido validado. De hecho, para validar que el valor del campo <code>slug</code> sea único, el validador no sólo debe acceder al propio valor del campo <code>slug</code>, sino que también debe conocer el valor de la clave primaria. Además, las reglas de validación son diferentes en la fase de creación de datos y en la de modificación, ya que el <em>slug</em> puede permanecer invariante mientras se modifica un artículo.</p>

<p>A continuación se modifica el campo <code>active</code> de la tabla <code>author</code>, que indica si un autor se encuentra activo. El listado 11-10 muestra cómo excluir a los autores inactivos en el formulario <code>ArticleForm</code>, modificando la opción <code>query</code> del widget <code>sfWidgetDoctrineSelect</code> asociado con el campo <code>author_id</code>. La opción <code>query</code> acepta un objeto de tipo consulta de Doctrine, lo que permite restringir los valores mostrados en la lista desplegable asociada.</p>

<p><strong>Listado 11-10 - Personalizando el widget <code>sfWidgetDoctrineSelect</code></strong></p>

<div class="code php">
<pre class="php"><span class="kw2">class</span> ArticleForm <span class="kw2">extends</span> BaseArticleForm
<span class="br0">&#123;</span>
  <span class="kw2">public</span> <span class="kw2">function</span> configure<span class="br0">&#40;</span><span class="br0">&#41;</span>
  <span class="br0">&#123;</span>
    <span class="co1">// ...</span>
&nbsp;
    <span class="re0">$query</span> <span class="sy0">=</span> Doctrine_Query<span class="sy0">::</span><span class="me2">create</span><span class="br0">&#40;</span><span class="br0">&#41;</span>
      <span class="sy0">-&gt;</span><span class="me1">from</span><span class="br0">&#40;</span><span class="st_h">'Author a'</span><span class="br0">&#41;</span>
      <span class="sy0">-&gt;</span><span class="me1">where</span><span class="br0">&#40;</span><span class="st_h">'a.active = ?'</span><span class="sy0">,</span> <span class="kw4">true</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">widgetSchema</span><span class="br0">&#91;</span><span class="st_h">'author_id'</span><span class="br0">&#93;</span><span class="sy0">-&gt;</span><span class="me1">setOption</span><span class="br0">&#40;</span><span class="st_h">'query'</span><span class="sy0">,</span> <span class="re0">$query</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</div>

<p>Personalizar el widget permite restringir las opciones que se muestran en la lista desplegable, pero no olvides que también es necesario realizar esta modificación en el validador, tal y como muestra el listado 11-11. Al igual que el widget <code>sfWidgetProperSelect</code>, el validador <code>sfValidatorDoctrineChoice</code> acepta una opción llamada <code>query</code> que permite restringir los valores válidos para un campo del formulario.</p>

<p><strong>Listado 11-11 - Personalizando el validador <code>sfValidatorDoctrineChoice</code></strong></p>

<div class="code php">
<pre class="php"><span class="kw2">class</span> ArticleForm <span class="kw2">extends</span> BaseArticleForm
<span class="br0">&#123;</span>
  <span class="kw2">public</span> <span class="kw2">function</span> configure<span class="br0">&#40;</span><span class="br0">&#41;</span>
  <span class="br0">&#123;</span>
    <span class="co1">// ...</span>
&nbsp;
    <span class="re0">$query</span> <span class="sy0">=</span> Doctrine_Query<span class="sy0">::</span><span class="me2">create</span><span class="br0">&#40;</span><span class="br0">&#41;</span>
      <span class="sy0">-&gt;</span><span class="me1">from</span><span class="br0">&#40;</span><span class="st_h">'Author a'</span><span class="br0">&#41;</span>
      <span class="sy0">-&gt;</span><span class="me1">where</span><span class="br0">&#40;</span><span class="st_h">'a.active = ?'</span><span class="sy0">,</span> <span class="kw4">true</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">widgetSchema</span><span class="br0">&#91;</span><span class="st_h">'author_id'</span><span class="br0">&#93;</span><span class="sy0">-&gt;</span><span class="me1">setOption</span><span class="br0">&#40;</span><span class="st_h">'query'</span><span class="sy0">,</span> <span class="re0">$query</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">validatorSchema</span><span class="br0">&#91;</span><span class="st_h">'author_id'</span><span class="br0">&#93;</span><span class="sy0">-&gt;</span><span class="me1">setOption</span><span class="br0">&#40;</span><span class="st_h">'query'</span><span class="sy0">,</span> <span class="re0">$query</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</div>

<p>En el ejemplo anterior, se define el objeto <code>Query</code> directamente en el método <code>configure()</code>. En el proyecto que se está realizando, esta consulta puede ser útil en muchas otras circunstancias, por lo que es mejor crear un método llamado <code>getActiveAuthorsQuery()</code> en la clase <code>AuthorPeer</code> e invocar este método desde <code>ArticleForm</code>, tal y como muestra el listado 11-12.</p>

<p><strong>Listado 11-12 - Refactorizando la consulta con <code>Query</code> en el modelo</strong></p>

<div class="code php">
<pre class="php"><span class="kw2">class</span> AuthorTable <span class="kw2">extends</span> Doctrine_Table
<span class="br0">&#123;</span>
  <span class="kw2">public</span> <span class="kw2">function</span> getActiveAuthorsQuery<span class="br0">&#40;</span><span class="br0">&#41;</span>
  <span class="br0">&#123;</span>
    <span class="re0">$query</span> <span class="sy0">=</span> Doctrine_Query<span class="sy0">::</span><span class="me2">create</span><span class="br0">&#40;</span><span class="br0">&#41;</span>
      <span class="sy0">-&gt;</span><span class="me1">from</span><span class="br0">&#40;</span><span class="st_h">'Author a'</span><span class="br0">&#41;</span>
      <span class="sy0">-&gt;</span><span class="me1">where</span><span class="br0">&#40;</span><span class="st_h">'a.active = ?'</span><span class="sy0">,</span> <span class="kw4">true</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    <span class="kw1">return</span> <span class="re0">$query</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span>
&nbsp;
<span class="kw2">class</span> ArticleForm <span class="kw2">extends</span> BaseArticleForm
<span class="br0">&#123;</span>
  <span class="kw2">public</span> <span class="kw2">function</span> configure<span class="br0">&#40;</span><span class="br0">&#41;</span>
  <span class="br0">&#123;</span>
    <span class="re0">$authorQuery</span> <span class="sy0">=</span> Doctrine<span class="sy0">::</span><span class="me2">getTable</span><span class="br0">&#40;</span><span class="st_h">'Author'</span><span class="br0">&#41;</span><span class="sy0">-&gt;</span><span class="me1">getActiveAuthorsQuery</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">widgetSchema</span><span class="br0">&#91;</span><span class="st_h">'author_id'</span><span class="br0">&#93;</span><span class="sy0">-&gt;</span><span class="me1">setOption</span><span class="br0">&#40;</span><span class="st_h">'query'</span><span class="sy0">,</span> <span class="re0">$authorQuery</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">validatorSchema</span><span class="br0">&#91;</span><span class="st_h">'author_id'</span><span class="br0">&#93;</span><span class="sy0">-&gt;</span><span class="me1">setOption</span><span class="br0">&#40;</span><span class="st_h">'query'</span><span class="sy0">,</span> <span class="re0">$authorQuery</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</div>

<div class="admonition note"><p><strong class="title">Nota</strong> De la misma forma que el widget <code>sfWidgetDoctrineSelect</code> y el validador <code>sfValidatorDoctrineChoice</code> representan una relación 1-n entre dos tablas, el widget <code>sfWidgetDoctrineSelectMany</code> y el validador <code>sfValidatorDoctrineChoiceMany</code> representan una relación n-n con las mismas opciones que los anteriores. El formulario <code>ArticleForm</code> utiliza estas clases para representar la relación entre las tablas <code>article</code> y <code>tag</code>.</p></div>

<h3 id="modificando_el_validador">11.4.2 Modificando el validador</h3>

<p>El esquema de datos define el campo <code>email</code> como un dato <code>string(255)</code>, por lo que Symfony crea un validador de tipo <code>sfValidatorString()</code> que restringe su longitud máxima a <code>255</code> caracteres. Como este campo también debe cumplir la condición de que sea una dirección de correo electrónico válida, el listado 11-14 reemplaza el validador generado automáticamente por un validador de tipo <code>sfValidatorEmail</code>.</p>

<p><strong>Listado 11-13 - Modificando el validador del campo <code>email</code> en la clase <code>AuthorForm</code></strong></p>

<div class="code php">
<pre class="php"><span class="kw2">class</span> AuthorForm <span class="kw2">extends</span> BaseAuthorForm
<span class="br0">&#123;</span>
  <span class="kw2">public</span> <span class="kw2">function</span> configure<span class="br0">&#40;</span><span class="br0">&#41;</span>
  <span class="br0">&#123;</span>
    <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">validatorSchema</span><span class="br0">&#91;</span><span class="st_h">'email'</span><span class="br0">&#93;</span> <span class="sy0">=</span> <span class="kw2">new</span> sfValidatorEmail<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</div>

<h3 id="anadiendo_un_validador">11.4.3 Añadiendo un validador</h3>

<p>En la sección anterior se modificó un validador generado automáticamente. Sin embargo, en el caso del campo <code>email</code>, lo ideal sería mantener el validador que controla su longitud máxima. En el listado 11-14 se emplea el validador <code>sfValidatorAnd</code> para asegurar que el email proporcionado sea válido y que su longitud no sea mayor que la longitud máxima permitida en ese campo.</p>

<p><strong>Listado 11-14 - Utilizando un validador múltiple</strong></p>

<div class="code php">
<pre class="php"><span class="kw2">class</span> AuthorForm <span class="kw2">extends</span> BaseAuthorForm
<span class="br0">&#123;</span>
  <span class="kw2">public</span> <span class="kw2">function</span> configure<span class="br0">&#40;</span><span class="br0">&#41;</span>
  <span class="br0">&#123;</span>
    <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">validatorSchema</span><span class="br0">&#91;</span><span class="st_h">'email'</span><span class="br0">&#93;</span> <span class="sy0">=</span> <span class="kw2">new</span> sfValidatorAnd<span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span>
      <span class="kw2">new</span> sfValidatorString<span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span><span class="st_h">'max_length'</span> <span class="sy0">=&gt;</span> <span class="nu0">255</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">,</span>
      <span class="kw2">new</span> sfValidatorEmail<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span>
    <span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</div>

<p>El código del ejemplo anterior no es ideal porque si más adelante se modifica el tamaño del campo <code>email</code> en el esquema de la base de datos, es necesario modificarlo también en el formulario. Por lo tanto, en vez de reemplazar el validador generado automáticamente, es mejor añadir uno nuevo, tal y como muestra el listado 11-15.</p>

<p><strong>Listado 11-15 - Añadiendo un validador</strong></p>

<div class="code php">
<pre class="php"><span class="kw2">class</span> AuthorForm <span class="kw2">extends</span> BaseAuthorForm
<span class="br0">&#123;</span>
  <span class="kw2">public</span> <span class="kw2">function</span> configure<span class="br0">&#40;</span><span class="br0">&#41;</span>
  <span class="br0">&#123;</span>
    <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">validatorSchema</span><span class="br0">&#91;</span><span class="st_h">'email'</span><span class="br0">&#93;</span> <span class="sy0">=</span> <span class="kw2">new</span> sfValidatorAnd<span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span>
      <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">validatorSchema</span><span class="br0">&#91;</span><span class="st_h">'email'</span><span class="br0">&#93;</span><span class="sy0">,</span>
      <span class="kw2">new</span> sfValidatorEmail<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span>
    <span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</div>

<h3 id="modificando_un_widget">11.4.4 Modificando un widget</h3>

<p>En el esquema de la base de datos, la tabla <code>article</code> almacena el estado de cada artículo en forma de cadena de caracteres en el campo <code>status</code>. Los posibles valores del estado se definen en la clase <code>ArticePeer</code>, tal y como muestra el listado 11-16.</p>

<p><strong>Listado 11-16 - Definiendo los posibles estados en la clase <code>ArticlePeer</code></strong></p>

<div class="code php">
<pre class="php"><span class="kw2">class</span> ArticlePeer <span class="kw2">extends</span> BaseArticlePeer
<span class="br0">&#123;</span>
  static <span class="kw2">protected</span> <span class="re0">$statuses</span> <span class="sy0">=</span> <span class="kw3">array</span><span class="br0">&#40;</span><span class="st_h">'draft'</span><span class="sy0">,</span> <span class="st_h">'online'</span><span class="sy0">,</span> <span class="st_h">'offline'</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
  static <span class="kw2">public</span> <span class="kw2">function</span> getStatuses<span class="br0">&#40;</span><span class="br0">&#41;</span>
  <span class="br0">&#123;</span>
    <span class="kw1">return</span> <span class="kw2">self</span><span class="sy0">::</span><span class="re0">$statuses</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
&nbsp;
  <span class="co1">// ...</span>
<span class="br0">&#125;</span></pre>
</div>

<p>Cuando se editan los datos de un artículo, el campo <code>status</code> se debería representar en forma de lista desplegable en vez de como un cuadro de texto. Para ello, se modifica el widget utilizado hasta el momento mediante el código mostrado en el listado 11-17.</p>

<p><strong>Listado 11-17 - Modificando el widget del campo <code>status</code></strong></p>

<div class="code php">
<pre class="php"><span class="kw2">class</span> ArticleForm <span class="kw2">extends</span> BaseArticleForm
<span class="br0">&#123;</span>
  <span class="kw2">public</span> <span class="kw2">function</span> configure<span class="br0">&#40;</span><span class="br0">&#41;</span>
  <span class="br0">&#123;</span>
    <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">widgetSchema</span><span class="br0">&#91;</span><span class="st_h">'status'</span><span class="br0">&#93;</span> <span class="sy0">=</span> <span class="kw2">new</span> sfWidgetFormSelect<span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span><span class="st_h">'choices'</span> <span class="sy0">=&gt;</span> ArticlePeer<span class="sy0">::</span><span class="me2">getStatuses</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</div>

<p>Para completar la modificación, también se debe cambiar el validador para asegurar que el estado seleccionado pertenece a alguna de las posibles opciones de la lista (ver listado 11-18).</p>

<p><strong>Listado 11-18 - Modificando el validador del campo <code>status</code></strong></p>

<div class="code php">
<pre class="php"><span class="kw2">class</span> ArticleForm <span class="kw2">extends</span> BaseArticleForm
<span class="br0">&#123;</span>
  <span class="kw2">public</span> <span class="kw2">function</span> configure<span class="br0">&#40;</span><span class="br0">&#41;</span>
  <span class="br0">&#123;</span>
    <span class="re0">$statuses</span> <span class="sy0">=</span> ArticlePeer<span class="sy0">::</span><span class="me2">getStatuses</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">widgetSchema</span><span class="br0">&#91;</span><span class="st_h">'status'</span><span class="br0">&#93;</span> <span class="sy0">=</span> <span class="kw2">new</span> sfWidgetFormSelect<span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span><span class="st_h">'choices'</span> <span class="sy0">=&gt;</span> <span class="re0">$statuses</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">validatorSchema</span><span class="br0">&#91;</span><span class="st_h">'status'</span><span class="br0">&#93;</span> <span class="sy0">=</span> <span class="kw2">new</span> sfValidatorChoice<span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span><span class="st_h">'choices'</span> <span class="sy0">=&gt;</span> <span class="kw3">array_keys</span><span class="br0">&#40;</span><span class="re0">$statuses</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</div>

<h3 id="eliminando_un_campo">11.4.5 Eliminando un campo</h3>

<p>La tabla <code>article</code> dispone de dos columnas especiales llamadas <code>created_at</code> y <code>updated_at</code>, para las cuales Doctrine actualiza automáticamente sus valores. Para evitar que el usuario las modifique, el listado 11-19 muestra cómo se pueden eliminar del formulario.</p>

<p><strong>Listado 11-19 - Eliminando un campo</strong></p>

<div class="code php">
<pre class="php"><span class="kw2">class</span> ArticleForm <span class="kw2">extends</span> BaseArticleForm
<span class="br0">&#123;</span>
  <span class="kw2">public</span> <span class="kw2">function</span> configure<span class="br0">&#40;</span><span class="br0">&#41;</span>
  <span class="br0">&#123;</span>
    <span class="kw3">unset</span><span class="br0">&#40;</span><span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">validatorSchema</span><span class="br0">&#91;</span><span class="st_h">'created_at'</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw3">unset</span><span class="br0">&#40;</span><span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">widgetSchema</span><span class="br0">&#91;</span><span class="st_h">'created_at'</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    <span class="kw3">unset</span><span class="br0">&#40;</span><span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">validatorSchema</span><span class="br0">&#91;</span><span class="st_h">'updated_at'</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw3">unset</span><span class="br0">&#40;</span><span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">widgetSchema</span><span class="br0">&#91;</span><span class="st_h">'updated_at'</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</div>

<p>Para eliminar un campo es preciso eliminar su validador y su widget. El listado 11-20 muestra cómo borrar los dos con una única instrucción accediendo al formulario como si fuera un array de PHP.</p>

<p><strong>Listado 11-20 - Eliminando un campo accediendo al formulario como si fuera un array de PHP</strong></p>

<div class="code php">
<pre class="php"><span class="kw2">class</span> ArticleForm <span class="kw2">extends</span> BaseArticleForm
<span class="br0">&#123;</span>
  <span class="kw2">public</span> <span class="kw2">function</span> configure<span class="br0">&#40;</span><span class="br0">&#41;</span>
  <span class="br0">&#123;</span>
    <span class="kw3">unset</span><span class="br0">&#40;</span><span class="re0">$this</span><span class="br0">&#91;</span><span class="st_h">'created_at'</span><span class="br0">&#93;</span><span class="sy0">,</span> <span class="re0">$this</span><span class="br0">&#91;</span><span class="st_h">'updated_at'</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</div>

<h3 id="resumiendo">11.4.6 Resumiendo</h3>

<p>Los listados 11-21 y 11-22 muestran el código definitivo de los formularios <code>ArticleForm</code> y <code>AuthorForm</code> después de personalizarlos.</p>

<p><strong>Listado 11-21 - Formulario <code>ArticleForm</code></strong></p>

<div class="code php">
<pre class="php"><span class="kw2">class</span> ArticleForm <span class="kw2">extends</span> BaseArticleForm
<span class="br0">&#123;</span>
  <span class="kw2">public</span> <span class="kw2">function</span> configure<span class="br0">&#40;</span><span class="br0">&#41;</span>
  <span class="br0">&#123;</span>
    <span class="re0">$authorQuery</span> <span class="sy0">=</span> Doctrine<span class="sy0">::</span><span class="me2">getTable</span><span class="br0">&#40;</span><span class="st_h">'Author'</span><span class="br0">&#41;</span><span class="sy0">-&gt;</span><span class="me1">getActiveAuthorsQuery</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    <span class="co1">// widgets</span>
    <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">widgetSchema</span><span class="br0">&#91;</span><span class="st_h">'content'</span><span class="br0">&#93;</span><span class="sy0">-&gt;</span><span class="me1">setAttributes</span><span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span><span class="st_h">'rows'</span> <span class="sy0">=&gt;</span> <span class="nu0">10</span><span class="sy0">,</span> <span class="st_h">'cols'</span> <span class="sy0">=&gt;</span> <span class="nu0">40</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">widgetSchema</span><span class="br0">&#91;</span><span class="st_h">'status'</span><span class="br0">&#93;</span> <span class="sy0">=</span> <span class="kw2">new</span> sfWidgetFormSelect<span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span><span class="st_h">'choices'</span> <span class="sy0">=&gt;</span> ArticlePeer<span class="sy0">::</span><span class="me2">getStatuses</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">widgetSchema</span><span class="br0">&#91;</span><span class="st_h">'author_id'</span><span class="br0">&#93;</span><span class="sy0">-&gt;</span><span class="me1">setOption</span><span class="br0">&#40;</span><span class="st_h">'query'</span><span class="sy0">,</span> <span class="re0">$authorQuery</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    <span class="co1">// validators</span>
    <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">validatorSchema</span><span class="br0">&#91;</span><span class="st_h">'slug'</span><span class="br0">&#93;</span><span class="sy0">-&gt;</span><span class="me1">setOption</span><span class="br0">&#40;</span><span class="st_h">'required'</span><span class="sy0">,</span> <span class="kw4">false</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">validatorSchema</span><span class="br0">&#91;</span><span class="st_h">'content'</span><span class="br0">&#93;</span><span class="sy0">-&gt;</span><span class="me1">setOption</span><span class="br0">&#40;</span><span class="st_h">'min_length'</span><span class="sy0">,</span> <span class="nu0">5</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">validatorSchema</span><span class="br0">&#91;</span><span class="st_h">'status'</span><span class="br0">&#93;</span> <span class="sy0">=</span> <span class="kw2">new</span> sfValidatorChoice<span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span><span class="st_h">'choices'</span> <span class="sy0">=&gt;</span> <span class="kw3">array_keys</span><span class="br0">&#40;</span>ArticlePeer<span class="sy0">::</span><span class="me2">getStatuses</span><span class="br0">&#40;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">validatorSchema</span><span class="br0">&#91;</span><span class="st_h">'author_id'</span><span class="br0">&#93;</span><span class="sy0">-&gt;</span><span class="me1">setOption</span><span class="br0">&#40;</span><span class="st_h">'query'</span><span class="sy0">,</span> <span class="re0">$authorQuery</span><span class="br0">&#41;</span><span class="sy0">;</span>
&nbsp;
    <span class="kw3">unset</span><span class="br0">&#40;</span><span class="re0">$this</span><span class="br0">&#91;</span><span class="st_h">'created_at'</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
    <span class="kw3">unset</span><span class="br0">&#40;</span><span class="re0">$this</span><span class="br0">&#91;</span><span class="st_h">'updated_at'</span><span class="br0">&#93;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</div>

<p><strong>Listado 11-22 - Formulario <code>AuthorForm</code></strong></p>

<div class="code php">
<pre class="php"><span class="kw2">class</span> AuthorForm <span class="kw2">extends</span> BaseAuthorForm
<span class="br0">&#123;</span>
  <span class="kw2">public</span> <span class="kw2">function</span> configure<span class="br0">&#40;</span><span class="br0">&#41;</span>
  <span class="br0">&#123;</span>
    <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">validatorSchema</span><span class="br0">&#91;</span><span class="st_h">'email'</span><span class="br0">&#93;</span> <span class="sy0">=</span> <span class="kw2">new</span> sfValidatorAnd<span class="br0">&#40;</span><span class="kw3">array</span><span class="br0">&#40;</span>
      <span class="re0">$this</span><span class="sy0">-&gt;</span><span class="me1">validatorSchema</span><span class="br0">&#91;</span><span class="st_h">'email'</span><span class="br0">&#93;</span><span class="sy0">,</span>
      <span class="kw2">new</span> sfValidatorEmail<span class="br0">&#40;</span><span class="br0">&#41;</span><span class="sy0">,</span>
    <span class="br0">&#41;</span><span class="br0">&#41;</span><span class="sy0">;</span>
  <span class="br0">&#125;</span>
<span class="br0">&#125;</span></pre>
</div>

<p>La tarea <code>doctrine:build-forms</code> permite generar automáticamente la mayoría de elementos de los formularios mediante la introspección del modelo de objetos. Las principales ventajas de esta automatización son:</p>

<ul>
<li>Mejora la productividad del programador, evitándole todo el trabajo repetitivo y redundante. De esta forma el programador sólo se encarga de personalizar los validadores y los widgets en función de la lógica de negocio de la aplicación.</li>
<li>Si se actualiza el esquema de datos, los formularios generados también se actualizan automáticamente. Una vez más, el programador sólo se encarga de ajustar la personalización realizada anteriormente.</li>
</ul>

<p>La siguiente sección trata de la modificación de las acciones y plantillas generadas por la tarea <code>doctrine:generate-crud</code>.</p>



    <div class="navigation row">
            <a class="span4 prev" href="el_generador_crud.html">&larr; Anterior <span>11.3 El generador CRUD</span></a>
            
            <a class="span5 next" href="serializacion_de_formularios.html">Siguiente &rarr; <span>11.5 Serialización de formularios</span></a>
        </div>
</div>

<div class="span3 side">
<h3 class="underline"><span>Compartir</span></h3>
<ul class="share">
    <li><a class="twitter" id="share_twitter" href="#" title="Compartir este artículo en Twitter">tw</a></li>
    <li><a class="facebook" id="share_facebook" href="#" title="Compartir este artículo en Facebook">fb</a></li>
    <li><a class="google" id="share_google" href="#" title="Compartir este artículo en Google+">g+</a></li>
</ul>

<script type="text/javascript">
var title    = 'Personalizando los formularios generados (Los formularios de Symfony 1.4%29';
var page_url = encodeURIComponent(window.location);
var options  = 'menubar=no,toolbar=no,resizable=yes,scrollbars=no,width=640,height=350';
var services = {
    share_twitter:  'https://twitter.com/share?text=' + title + '&lang=es&hashtags=librosweb',
    share_facebook: 'http://www.facebook.com/sharer.php?u=' + page_url + '&t=' + title,
    share_google:   'https://plus.google.com/share?url=' + page_url + '&hl=es'
};

for (var id in services) { // don't use services.keys() for compatibility reasons
    if (services.hasOwnProperty(id)) {
        document.getElementById(id).href = services[id];
        document.getElementById(id).onclick = function(a) {
            a = a || window.event;
            a = a.target || a.srcElement;
            _gaq.push(['_trackEvent', 'share', a.id.substr(6), 'Los formularios de Symfony 1.4 : Personalizando los formularios generados']);
            window.open(services[a.id], a.title, options);

            return false;
        };
    }
}
</script>

<h3 class="underline"><span>Indice de contenidos</span></h3>
<ul class="toc">
                <li class="level-1">
            <span>1.</span>
            <a href="../capitulo_1.html">Creación de formularios</a>
        </li>
                                            <li class="level-1">
            <span>2.</span>
            <a href="../capitulo_2.html">Validación de formularios</a>
        </li>
                                                                            <li class="level-1">
            <span>3.</span>
            <a href="../capitulo_3.html">Formularios para diseñadores web</a>
        </li>
                                                                    <li class="level-1">
            <span>4.</span>
            <a href="../capitulo_4.html">Integración con Propel</a>
        </li>
                                                                    <li class="level-1">
            <span>5.</span>
            <a href="../capitulo_5.html">Sin título</a>
        </li>
                    <li class="level-1">
            <span>6.</span>
            <a href="../capitulo_6.html">Sin título</a>
        </li>
                    <li class="level-1">
            <span>7.</span>
            <a href="../capitulo_7.html">Sin título</a>
        </li>
                    <li class="level-1">
            <span>8.</span>
            <a href="../capitulo_8.html">Internacionalización y localización</a>
        </li>
                                                    <li class="level-1">
            <span>9.</span>
            <a href="../capitulo_9.html">Sin título</a>
        </li>
                    <li class="level-1">
            <span>10.</span>
            <a href="../capitulo_10.html">Sin título</a>
        </li>
                    <li class="level-1 ">
            <a href="../capitulo_11.html">
                <span>Capítulo 11.</span>
                Integrando Doctrine
            </a>
        </li>
                        <li class="level-2 ">
            <a href="antes_de_comenzar.html">
                <span>11.1.</span>
                Antes de comenzar
            </a>
        </li>
                        <li class="level-2 ">
            <a href="generando_las_clases_del_formulario.html">
                <span>11.2.</span>
                Generando las clases del formulario
            </a>
        </li>
                        <li class="level-2 ">
            <a href="el_generador_crud.html">
                <span>11.3.</span>
                El generador CRUD
            </a>
        </li>
                        <li class="level-2 active">
            <a href="personalizando_los_formularios_generados.html">
                <span>11.4.</span>
                Personalizando los formularios generados
            </a>
        </li>
                        <li class="level-2 ">
            <a href="serializacion_de_formularios.html">
                <span>11.5.</span>
                Serialización de formularios
            </a>
        </li>
                        <li class="level-1">
            <span>12.</span>
            <a href="../capitulo_12.html">Referencia de Widgets</a>
        </li>
                                                                                            <li class="level-1">
            <span>13.</span>
            <a href="../capitulo_13.html">Validadores</a>
        </li>
                                                                            </ul>
</div>
        </div></div>
        <div id="footer" class="row">
            <span class="span6">&copy; 2013 LibrosWeb.es 
            <a href="../../contacto/index.html">Contacto</a></span>
            <span class="span6 version">2.340 días online</span>
        </div>
    </div>
    </body>
</html>

<!-- Localized -->